AT_INIT()


AT_SETUP(version)
dnl      ------

@DO_GETOPTJAR_TRUE@AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar -V|@AWK@ '{print $1,$2,$3}'], 0, [vw4tool version @VERSION@-@BUILDID@
@DO_GETOPTJAR_TRUE@], [])
@DO_GETOPTJAR_FALSE@AT_CHECK([java -jar $abs_top_builddir/convjars/@PACKAGE@.jar -V], 0, [@VERSION@-@BUILDID@
@DO_GETOPTJAR_FALSE@], [])

@DO_GETOPTJAR_TRUE@AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar --version|@AWK@ '{print $1,$2,$3}'], 0, [vw4tool version @VERSION@-@BUILDID@
@DO_GETOPTJAR_TRUE@], [])
@DO_GETOPTJAR_FALSE@AT_CHECK([java -jar $abs_top_builddir/convjars/@PACKAGE@.jar --version], 0, [@VERSION@-@BUILDID@
@DO_GETOPTJAR_FALSE@], [])

AT_CLEANUP()



AT_SETUP(check for version-setting breakage)
dnl      ----------------------------------

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.showCompatTarget=true -jar $abs_top_builddir/convjars/@PACKAGE@.jar --target=4.0.1], 0, [target set from @defaultcompattarget@ to 4.0.1 as 4.0.1
], [])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.showCompatTarget=true -jar $abs_top_builddir/convjars/@PACKAGE@.jar --target=4.0.2], 0, [target set from @defaultcompattarget@ to 4.0.2 as 4.0.2
], [])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.showCompatTarget=true -jar $abs_top_builddir/convjars/@PACKAGE@.jar --target=4.0], 0, [target set from @defaultcompattarget@ to 4.0 as 4.0.0
], [])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.showCompatTarget=true -jar $abs_top_builddir/convjars/@PACKAGE@.jar --target=4.0.1.6], 0, [target set from @defaultcompattarget@ to 4.0.1.6 as 4.0.1
], [])

AT_CLEANUP()



AT_SETUP(check for null file survival)
dnl      ----------------------------

AT_DATA([emptyline.csv], [
])

AT_DATA([emptyfile.csv], [])

dnl bogus test converted to an actual test
AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.verboseTokenizer=Alias4Parser -jar $abs_top_builddir/convjars/@PACKAGE@.jar --nickname=emptyline.csv], 0, [stdout], [stderr])
AT_CHECK([grep -v 'parsed 0 zones, 0 aliases' stdout | tee copyout|sort -u], 0, [], [])

dnl bogus test converted to an actual test
AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.verboseTokenizer=Alias4Parser -jar $abs_top_builddir/convjars/@PACKAGE@.jar --nickname=emptyfile.csv], 0, [stdout], [stderr])
AT_CHECK([grep -v 'parsed 0 zones, 0 aliases' stdout | tee copyout|sort -u], 0, [], [])

AT_CLEANUP()



AT_SETUP(verify pattern behavior)
dnl      -----------------------

AT_CHECK([java -Ddebug.showPattern=true -jar $abs_top_builddir/convjars/@PACKAGE@.jar --pattern="^(.*)_hba(\\d+)$" --checkpattern=NetApp-123456 --checkpattern=Oracle01 --checkpattern=Oracle01_hba0], 0, [stdout], [stderr])

AT_CHECK([java -jar $abs_top_builddir/convjars/@PACKAGE@.jar --pattern="^(.*)_hba(\\d+)$" --checkpattern=NetApp-123456 --checkpattern=Oracle01 --checkpattern=Oracle01_hba0], 0, ["NetApp-123456" --> "NetApp-123456"
"Oracle01" --> "Oracle01"
"Oracle01_hba0" --> "Oracle01"
], [stderr])

AT_CHECK([java -jar $abs_top_builddir/convjars/@PACKAGE@.jar --pattern="^(.*)_(hba|fc|fa|fab)(\\d+)$" --checkpattern=NetApp-123456 --checkpattern=Oracle01 --checkpattern=Oracle01_hba0], 0, ["NetApp-123456" --> "NetApp-123456"
"Oracle01" --> "Oracle01"
"Oracle01_hba0" --> "Oracle01"
], [stderr])

AT_CLEANUP()



AT_SETUP(alias4file prune wwn nicknames)
dnl      ------------------------------

AT_DATA([alias4file.csv], ["WWN",50:0A:09:85:98:12:34:56,500a098598123456,Storage
"WWN",50:0A:09:86:98:12:34:56,0x123456,Storage
"WWN",c0:50:76:12:34:56:00:fe,0x123457,Server
])

dnl bogus test converted to an actual test
AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.verboseTokenizer=Alias4Parser -jar $abs_top_builddir/convjars/@PACKAGE@.jar --nickname=alias4file.csv --nicknameout=alias4file.json], 0, [stdout], [stderr])
AT_CHECK([grep -v 'parsed 0 zones, 0 aliases' stdout | tee copyout|sort -u], 0, [(@PACKAGE@) parsed 0 zones, 3 aliases via Alias4Parser
], [])

AT_CHECK([cat alias4file.json], 0, [[{
  "entities" : [ {
    "description" : "c0507612345600fe,0x123457 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "LPAR-123456:00fe",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "c0507612345600fe"
  }, {
    "description" : "500a098598123456,500a098598123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456-iGrp1-0e",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "500a098598123456"
  }, {
    "description" : "500a098698123456,0x123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456-iGrp1-0f",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "500a098698123456"
  } ],
  "version" : "1"
}]], [])

AT_CHECK([java -Dcompat.target=4.0.0 -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar --target=4.0.1 --nickname=alias4file.csv --nicknameout=alias4file.json], 0, [stdout], [stderr])

AT_CHECK([cat alias4file.json], 0, [[{
  "entities" : [ {
    "child_entities" : {
      "add" : [ "c0507612345600fe" ]
    },
    "description" : "c0507612345600fe,0x123457 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "LPAR-123456:00fe",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "hba"
  }, {
    "child_entities" : {
      "add" : [ "500a098598123456" ]
    },
    "description" : "500a098598123456,500a098598123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456-iGrp1-0e",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "iomodule"
  }, {
    "child_entities" : {
      "add" : [ "500a098698123456" ]
    },
    "description" : "500a098698123456,0x123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456-iGrp1-0f",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "iomodule"
  } ],
  "version" : "1"
}]], [])

AT_CLEANUP()



AT_SETUP(alias4file prune fcid nicknames)
dnl      -------------------------------

AT_DATA([alias4file.csv], ["WWN",50:0A:09:85:98:12:34:56,NetApp-123456,Storage
"WWN",50:0A:09:86:98:12:34:56,0x123456,Storage
])

dnl bogus test converted to an actual test
AT_CHECK([java -Dcompat.target=4.0.0 -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.verboseTokenizer=Alias4Parser -jar $abs_top_builddir/convjars/@PACKAGE@.jar --nickname=alias4file.csv --nicknameout=alias4file.json], 0, [stdout], [stderr])
AT_CHECK([grep -v 'parsed 0 zones, 0 aliases' stdout | tee copyout|sort -u], 0, [(@PACKAGE@) parsed 0 zones, 2 aliases via Alias4Parser
], [])

AT_CHECK([cat alias4file.json], 0, [[{
  "entities" : [ {
    "child_entities" : {
      "add" : [ "500a098598123456" ]
    },
    "description" : "500a098598123456,NetApp-123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "iomodule"
  }, {
    "child_entities" : {
      "add" : [ "500a098698123456" ]
    },
    "description" : "500a098698123456,0x123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456-iGrp1-0f",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "iomodule"
  } ],
  "version" : "1"
}]], [])

AT_CLEANUP()



AT_SETUP(alias4file remove nicknames)
dnl      ---------------------------

AT_DATA([alias4file.csv], ["WWN",50:0A:09:85:98:12:34:56,NetApp-123456,Storage
"WWN",50:0A:09:86:98:12:34:56,0x123456,Storage
])

AT_DATA([remove.csv], ["WWN",50:0A:09:85:98:12:34:56,justaName,Storage
])

AT_CHECK([java -Dcompat.target=4.0.0 -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.verboseTokenizer=Alias4Parser -jar $abs_top_builddir/convjars/@PACKAGE@.jar --nickname=alias4file.csv --removenicknames=remove.csv --nicknameout=alias4file.json], 0, [stdout], [stderr])
AT_CHECK([grep -v 'parsed 0 zones, 0 aliases' stdout | tee copyout|sort -u], 0, [(@PACKAGE@) parsed 0 zones, 1 aliases via Alias4Parser
(@PACKAGE@) parsed 0 zones, 2 aliases via Alias4Parser
], [])

AT_CHECK([cat alias4file.json], 0, [[{
  "entities" : [ {
    "child_entities" : {
      "add" : [ "500a098698123456" ]
    },
    "description" : "500a098698123456,0x123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456-iGrp1-0f",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "iomodule"
  } ],
  "version" : "1"
}]], [])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.verboseTokenizer=Alias4Parser -jar $abs_top_builddir/convjars/@PACKAGE@.jar --nickname=alias4file.csv --removenicknames=remove.csv --nicknameout=alias4file.json], 0, [stdout], [stderr])
AT_CHECK([grep -v 'parsed 0 zones, 0 aliases' stdout | tee copyout|sort -u], 0, [(@PACKAGE@) parsed 0 zones, 1 aliases via Alias4Parser
(@PACKAGE@) parsed 0 zones, 2 aliases via Alias4Parser
], [])

AT_CHECK([cat alias4file.json], 0, [[{
  "entities" : [ {
    "description" : "500a098698123456,0x123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456-iGrp1-0f",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "500a098698123456"
  } ],
  "version" : "1"
}]], [])

AT_CLEANUP()



AT_SETUP(VW4InvalidAdded remove new fcports)
dnl      ----------------------------------

AT_DATA([alias4file.csv], ["WWN",50:0A:09:85:98:12:34:56,NetApp-123456,Storage
"WWN",50:0A:09:86:98:12:34:56,bogushost2,Storage
"WWN",50:0A:09:87:98:12:34:56,bogushost,Storage
])

AT_DATA([remove.txt], [[
Entity with given name already exist. Use edit type MODIFY to overwrite.
Entity: bogushost : host
Location: [Line : 2 , Column : 7]
New port entities can not be imported. These are automatically discovered.
Entity: bogushost2 : fcport
Location: [Line : 16 , Column : 7]
Invalid added child entities : 20c5000dec123456
Entity: Cisco-000dec-123456:197 : hba
Location: [Line : 24 , Column : 7]
]])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.verboseAddItem=VW4InvalidAddedParser -Ddebug.verboseTokenizer=Alias4Parser -jar $abs_top_builddir/convjars/@PACKAGE@.jar --nickname=alias4file.csv --removenicknames=remove.txt --nicknameout=alias4file.json], 0, [stdout], [stderr])
AT_CHECK([grep -v 'parsed 0 zones, 0 aliases' stdout | tee copyout|sort -u], 0, [(@PACKAGE@) parsed 0 zones, 1 aliases via VW4InvalidAddedParser
(@PACKAGE@) parsed 0 zones, 3 aliases via Alias4Parser
], [])

AT_CHECK([cat alias4file.json], 0, [[{
  "entities" : [ {
    "description" : "500a098598123456,NetApp-123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "500a098598123456"
  } ],
  "version" : "1"
}]], [])

AT_CLEANUP()



AT_SETUP(VW4InvalidAdded remove nicknames)
dnl      ---------------------------

AT_DATA([alias4file.csv], ["WWN",50:0A:09:85:98:12:34:56,NetApp-123456,Storage
"WWN",50:0A:09:86:98:12:34:56,0x123456,Storage
"WWN",50:0A:09:87:98:12:34:56,bogushost,Storage
])

AT_DATA([remove.txt], [[
Entity with given name already exist. Use edit type MODIFY to overwrite.
Entity: bogushost : host
Location: [Line : 2 , Column : 7]
Invalid entity type
Entity: Oracle44 : array
Location: [Line : 3 , Column : 19]
Invalid entity type
Entity: server12345 : array
Location: [Line : 6 , Column : 7]
Invalid added child entities : 500A098598123456
Entity: Cisco-000dec-123456:195 : hba
Location: [Line : 8 , Column : 7]
Invalid added child entities : 20c4000dec123456
Entity: Cisco-000dec-123456:196 : hba
Location: [Line : 16 , Column : 7]
Invalid added child entities : 20c5000dec123456
Entity: Cisco-000dec-123456:197 : hba
Location: [Line : 24 , Column : 7]
]])

AT_CHECK([java -Dcompat.target=4.0.0 -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.verboseTokenizer=Alias4Parser -jar $abs_top_builddir/convjars/@PACKAGE@.jar --nickname=alias4file.csv --removenicknames=remove.txt --nicknameout=alias4file.json], 0, [stdout], [stderr])
AT_CHECK([grep -v 'parsed 0 zones, 0 aliases' stdout | tee copyout|sort -u], 0, [(@PACKAGE@) parsed 0 zones, 3 aliases via Alias4Parser
(@PACKAGE@) parsed 0 zones, 3 aliases via VW4InvalidAddedParser
], [])

AT_CHECK([cat alias4file.json], 0, [[{
  "entities" : [ {
    "child_entities" : {
      "add" : [ "500a098698123456" ]
    },
    "description" : "500a098698123456,0x123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456-iGrp1-0f",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "iomodule"
  } ],
  "version" : "1"
}]], [])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.verboseTokenizer=Alias4Parser -jar $abs_top_builddir/convjars/@PACKAGE@.jar --nickname=alias4file.csv --removenicknames=remove.txt --nicknameout=alias4file.json], 0, [stdout], [stderr])
AT_CHECK([grep -v 'parsed 0 zones, 0 aliases' stdout | tee copyout|sort -u], 0, [(@PACKAGE@) parsed 0 zones, 3 aliases via Alias4Parser
(@PACKAGE@) parsed 0 zones, 3 aliases via VW4InvalidAddedParser
], [])

AT_CHECK([cat alias4file.json], 0, [[{
  "entities" : [ {
    "description" : "500a098698123456,0x123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456-iGrp1-0f",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "500a098698123456"
  } ],
  "version" : "1"
}]], [])

AT_CLEANUP()



AT_SETUP(alias4file to json via java)
dnl      ---------------------------

AT_DATA([alias4file.csv], ["WWN",50:0A:09:85:98:12:34:56,NetApp-123456,Storage
"WWN",50:0A:09:86:98:12:34:56,NetApp-123456,Storage
"WWN",10:00:00:00:c9:12:34:56,Oracle01,Server
"WWN",10:00:00:00:c9:12:34:57,Oracle01,Server
])

dnl bogus test converted to an actual test
AT_CHECK([java -Dcompat.target=4.0.0 -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.verboseTokenizer=Alias4Parser -jar $abs_top_builddir/convjars/@PACKAGE@.jar --pattern="([[^_]]+)_[[^_]]+$" --nickname=alias4file.csv --nicknameout=alias4file.json], 0, [stdout], [stderr])
AT_CHECK([grep -v 'parsed 0 zones, 0 aliases' stdout | tee copyout|sort -u], 0, [(@PACKAGE@) parsed 0 zones, 2 aliases via Alias4Parser
], [])

AT_CHECK([cat alias4file.json], 0, [[{
  "entities" : [ {
    "child_entities" : {
      "add" : [ "500a098598123456" ]
    },
    "description" : "500a098598123456,NetApp-123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "iomodule"
  }, {
    "child_entities" : {
      "add" : [ "500a098698123456" ]
    },
    "description" : "500a098698123456,NetApp-123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456_3456",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "iomodule"
  }, {
    "child_entities" : {
      "add" : [ "10000000c9123456" ]
    },
    "description" : "10000000c9123456,Oracle01 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "Oracle01",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "hba"
  }, {
    "child_entities" : {
      "add" : [ "10000000c9123457" ]
    },
    "description" : "10000000c9123457,Oracle01 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "Oracle01_3457",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "hba"
  } ],
  "version" : "1"
}]], [])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -Ddebug.verboseTokenizer=Alias4Parser -jar $abs_top_builddir/convjars/@PACKAGE@.jar --pattern="([[^_]]+)_[[^_]]+$" --nickname=alias4file.csv --nicknameout=alias4file.json], 0, [stdout], [stderr])
AT_CHECK([grep -v 'parsed 0 zones, 0 aliases' stdout | tee copyout|sort -u], 0, [(@PACKAGE@) parsed 0 zones, 2 aliases via Alias4Parser
], [])

AT_CHECK([cat alias4file.json], 0, [[{
  "entities" : [ {
    "description" : "500a098598123456,NetApp-123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "500a098598123456"
  }, {
    "description" : "500a098698123456,NetApp-123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456_3456",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "500a098698123456"
  }, {
    "description" : "10000000c9123456,Oracle01 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "Oracle01",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "10000000c9123456"
  }, {
    "description" : "10000000c9123457,Oracle01 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "Oracle01_3457",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "10000000c9123457"
  } ],
  "version" : "1"
}]], [])

AT_CLEANUP()



AT_SETUP(alias4file to json with patterns)
dnl      --------------------------------

AT_DATA([alias4file.csv], ["WWN",50:0A:09:85:98:12:34:56,NetApp-123456,Storage
"WWN",50:0A:09:86:98:12:34:56,NetApp-123456,Storage
"WWN",10:00:00:00:c9:12:34:56,Oracle01,Server
"WWN",10:00:00:00:c9:12:34:57,Oracle01,Server
])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar --pattern="([[^-]]+)-[[^-]]+$" --checkpattern=NetApp-123456 --checkpattern=Oracle01], 0, ["NetApp-123456" --> "NetApp"
"Oracle01" --> "Oracle01"
], [stderr])

AT_CHECK([java -Dcompat.target=4.0.0 -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar --nickname=alias4file.csv --pattern="([[^-]]+)-[[^-]]+$" --report --nicknameout=alias4file.json -oOrphanEntities.csv], 0, [stdout], [stderr])
AT_CHECK([grep -v 'parsed 0 zones, 0 aliases' stdout], 0, [(@PACKAGE@) parsed 0 zones, 2 aliases via Alias4Parser
@PACKAGE@ @VERSION@-@BUILDID@
    5 total entities
    4 leaf nodes
    2 orphans
50.00 % coverage
writing ordered tuples to OrphanEntities.csv
], [])

AT_CHECK([cat alias4file.json], 0, [[{
  "entities" : [ {
    "child_entities" : {
      "add" : [ "NetApp-123456", "NetApp-123456_3456" ]
    },
    "edit_type" : "add",
    "name" : "NetApp",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "storagearray"
  }, {
    "child_entities" : {
      "add" : [ "500a098598123456" ]
    },
    "description" : "500a098598123456,NetApp-123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "iomodule"
  }, {
    "child_entities" : {
      "add" : [ "500a098698123456" ]
    },
    "description" : "500a098698123456,NetApp-123456 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "NetApp-123456_3456",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "iomodule"
  }, {
    "child_entities" : {
      "add" : [ "10000000c9123456" ]
    },
    "description" : "10000000c9123456,Oracle01 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "Oracle01",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "hba"
  }, {
    "child_entities" : {
      "add" : [ "10000000c9123457" ]
    },
    "description" : "10000000c9123457,Oracle01 converted via Alias4Parser from alias4file.csv",
    "edit_type" : "add",
    "name" : "Oracle01_3457",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "hba"
  } ],
  "version" : "1"
}]], [])

AT_CHECK([cat OrphanEntities.csv], 0, [Oracle01,host,10000000c9123456,Oracle01
Oracle01_3457,host,10000000c9123457,Oracle01_3457
], [])

AT_CLEANUP()



AT_SETUP(csv-to-json awk script)
dnl      ----------------------

dnl 50:0A:09:85:98:D2:6B:D5 NetApp-d26bd5-iGrp1-0e
AT_DATA([c2v01.csv], [NetApp-123456,array,50:0A:09:85:98:12:34:56
NetApp-123456,array,50:0A:09:86:98:12:34:56
Oracle01,host,10:00:00:00:c9:12:34:56
Oracle01,host,10:00:00:00:c9:12:34:57
])

AT_CHECK([@AWK@ -f $abs_top_builddir/scripts/csv-to-json.awk c2v01.csv], 0, [[{
  "version" : 1,
   "entities" : [
   {
      "name" : "NetApp-123456",
      "type" : "storagearray",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add",
      "child_entities" : { "add" : [ "NetApp-123456-00", "NetApp-123456-01" ] }
   },
   {
      "name" : "NetApp-123456-00",
      "type" : "iomodule",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add",
      "child_entities" : { "add" : [ "50:0A:09:86:98:12:34:56" ] }
   },
   {
      "name" : "NetApp-123456-01",
      "type" : "iomodule",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add",
      "child_entities" : { "add" : [ "50:0A:09:85:98:12:34:56" ] }
   },
   {
      "name" : "Oracle01",
      "type" : "host",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add",
      "child_entities" : { "add" : [ "Oracle01-00", "Oracle01-01" ] }
   },
   {
      "name" : "Oracle01-00",
      "type" : "hba",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add", 
      "child_entities" : { "add" : [ "10:00:00:00:c9:12:34:56" ] }
   },
   {
      "name" : "Oracle01-01",
      "type" : "hba",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add", 
      "child_entities" : { "add" : [ "10:00:00:00:c9:12:34:57" ] }
   }
]
}
]], [])

AT_DATA([c2v02.csv], [Oracle01,host,10:00:00:00:c9:12:34:56,Oracle01-A
Oracle01,host,10:00:00:00:c9:12:34:57,Oracle01-B
])

AT_CHECK([@AWK@ -f $abs_top_builddir/scripts/csv-to-json.awk c2v02.csv], 0, [[{
  "version" : 1,
   "entities" : [
   {
      "name" : "Oracle01",
      "type" : "host",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add",
      "child_entities" : { "add" : [ "Oracle01-A", "Oracle01-B" ] }
   },
   {
      "name" : "Oracle01-A",
      "type" : "hba",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add", 
      "child_entities" : { "add" : [ "10:00:00:00:c9:12:34:56" ] }
   },
   {
      "name" : "Oracle01-B",
      "type" : "hba",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add", 
      "child_entities" : { "add" : [ "10:00:00:00:c9:12:34:57" ] }
   }
]
}
]], [])

AT_DATA([c2v03.csv], [NetApp-123456,array,50:0A:09:85:98:12:34:56,NetApp-Blue-iGrp1-0e
NetApp-123456,array,50:0A:09:86:98:12:34:56,NetApp-Blue-iGrp1-0f
])

AT_CHECK([@AWK@ -f $abs_top_builddir/scripts/csv-to-json.awk c2v03.csv], 0, [[{
  "version" : 1,
   "entities" : [
   {
      "name" : "NetApp-123456",
      "type" : "storagearray",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add",
      "child_entities" : { "add" : [ "NetApp-Blue-iGrp1-0f", "NetApp-Blue-iGrp1-0e" ] }
   },
   {
      "name" : "NetApp-Blue-iGrp1-0f",
      "type" : "iomodule",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add", 
      "child_entities" : { "add" : [ "50:0A:09:86:98:12:34:56" ] }
   },
   {
      "name" : "NetApp-Blue-iGrp1-0e",
      "type" : "iomodule",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add", 
      "child_entities" : { "add" : [ "50:0A:09:85:98:12:34:56" ] }
   }
]
}
]], [])

AT_CHECK([@AWK@ -v SKIPARRAY="barkbark" -f $abs_top_builddir/scripts/csv-to-json.awk c2v03.csv], 0, [[{
  "version" : 1,
   "entities" : [
   {
      "name" : "NetApp-Blue-iGrp1-0f",
      "type" : "iomodule",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add", 
      "child_entities" : { "add" : [ "50:0A:09:86:98:12:34:56" ] }
   },
   {
      "name" : "NetApp-Blue-iGrp1-0e",
      "type" : "iomodule",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add", 
      "child_entities" : { "add" : [ "50:0A:09:85:98:12:34:56" ] }
   }
]
}
]], [])

AT_CLEANUP()



AT_SETUP(csv-to-json awk script dirtydata)
dnl      --------------------------------

AT_DATA([c2v01.csv], ["NetApp-123456",array,50:0A:09:85:98:12:34:56
" Oracle01",host,"10:00:00:00:c9:12:34:56"
])

AT_CHECK([@AWK@ -f $abs_top_builddir/scripts/csv-to-json.awk c2v01.csv], 0, [[{
  "version" : 1,
   "entities" : [
   {
      "name" : "NetApp-123456",
      "type" : "storagearray",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add",
      "child_entities" : { "add" : [ "NetApp-123456-00" ] }
   },
   {
      "name" : "NetApp-123456-00",
      "type" : "iomodule",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add",
      "child_entities" : { "add" : [ "50:0A:09:85:98:12:34:56" ] }
   },
   {
      "name" : "Oracle01",
      "type" : "host",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add",
      "child_entities" : { "add" : [ "Oracle01-00" ] }
   },
   {
      "name" : "Oracle01-00",
      "type" : "hba",
      "tags" : [ "csv2json Import" ],
      "edit_type" : "add",
      "child_entities" : { "add" : [ "10:00:00:00:c9:12:34:56" ] }
   }
]
}
]], [])

AT_CLEANUP()



AT_SETUP(read sample DAD to create JSON)
dnl      ------------------------------

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar -N abs_top_srcdir/samples/simple.devicealias], 0, [stdout], [stderr])
AT_CHECK([grep -c ' 6 aliases via DeviceAliasParser' stdout], 0, [1
], [])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar --pattern="([[^_]]+)_hba[[0-9]]+$" -N abs_top_srcdir/samples/simple.devicealias -oOrderedTuples.csv], 0, [stdout], [stderr])

AT_CHECK([cat OrderedTuples.csv], 0, [oracle10_hba0,host,21000024ff123456,oracle10_hba0
oracle10_hba1,host,22000024ff123456,oracle10_hba1
server44_hba0,host,10000000c9123456,server44_hba0
server44_hba1,host,10000000c9123457,server44_hba1
vmax-18641-fa06a0,array,5000097201234554,vmax-18641-fa06a0
vmax-18641-fa07a0,array,5000097201234558,vmax-18641-fa07a0
], [])

AT_CLEANUP()



AT_SETUP(dupe name in nicknames)
dnl      ----------------------

AT_DATA([alias4file.csv], ["WWN",50:0A:09:85:98:12:34:56,NetApp-123456,Storage
"WWN",50:0A:09:86:98:12:34:56,NetApp-123456,Storage
"WWN",20:01:00:15:60:12:34:56,MPV123456,Server
"WWN",20:13:00:15:60:12:34:56,MPV123456,Server
"WWN",10:00:00:00:c9:12:34:56,Oracle01,Server
"WWN",10:00:00:00:c9:12:34:57,Oracle01,Server
])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar -N alias4file.csv], 0, [stdout], [stderr])

AT_CHECK([grep -c ' 3 aliases via Alias4Parser' stdout], 0, [1
], [])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar -N alias4file.csv -oOrderedTuples.csv], 0, [stdout], [stderr])

AT_CHECK([cat OrderedTuples.csv], 0, [MPV123456-001,host,2001001560123456,MPV123456-001
MPV123456-013,host,2013001560123456,MPV123456-013
NetApp-123456,array,500a098598123456,NetApp-123456
NetApp-123456_3456,array,500a098698123456,NetApp-123456_3456
Oracle01,host,10000000c9123456,Oracle01
Oracle01_3457,host,10000000c9123457,Oracle01_3457
], [])

AT_CLEANUP()



AT_SETUP(dupe WWPN in nicknames)
dnl      ----------------------

AT_DATA([nicknamefile.csv], [10000000c9123456,Oracle01,Server
10000000c9123456,Oracle01
])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar -N nicknamefile.csv], 0, [stdout], [stderr])

AT_CHECK([grep -c ' 1 aliases via NicknameParser' stdout], 0, [1
], [])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar -N nicknamefile.csv -oOrderedTuples.csv], 0, [stdout], [stderr])

AT_CHECK([cat OrderedTuples.csv], 0, [Oracle01,host,10000000c9123456,Oracle01
], [])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar -N nicknamefile.csv -o -], 0, [[(vw4tools) parsed 0 zones, 1 aliases via NicknameParser
(vw4tools) parsed 0 zones, 0 aliases via AliShowZoneParser
(vw4tools) parsed 0 zones, 0 aliases via Alias4Parser
(vw4tools) parsed 0 zones, 0 aliases via BNAZoneParser
(vw4tools) parsed 0 zones, 0 aliases via DeviceAliasParser
(vw4tools) parsed 0 zones, 0 aliases via ShowZoneParser
(vw4tools) parsed 0 zones, 0 aliases via ShowZone2Parser
(vw4tools) parsed 0 zones, 0 aliases via VW4InvalidAddedParser
{
  "entities" : [ {
    "description" : "10000000c9123456,Oracle01 converted via NicknameParser from nicknamefile.csv",
    "edit_type" : "add",
    "name" : "Oracle01",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "10000000c9123456"
  } ],
  "version" : "1"
}
]], [stderr])

AT_CLEANUP()



AT_SETUP(dupe name ignorecase in nicknames)
dnl      ---------------------------------

AT_DATA([nicknamefile.csv], [10000000c9123456,Oracle01,Server
10000000c9123457,oracle01
])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar -N nicknamefile.csv], 0, [stdout], [stderr])

AT_CHECK([grep -c ' 2 aliases via NicknameParser' stdout], 0, [1
], [])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar -N nicknamefile.csv -oOrderedTuples.csv], 0, [stdout], [stderr])

AT_CHECK([cat OrderedTuples.csv], 0, [Oracle01,host,10000000c9123456,Oracle01
oracle01_3457,host,10000000c9123457,oracle01_3457
], [])

AT_CHECK([java -Ddebug.silentTimeout=@NOVERTIMEOUTWARNING@ -jar $abs_top_builddir/convjars/@PACKAGE@.jar -N nicknamefile.csv -o -], 0, [[(vw4tools) parsed 0 zones, 2 aliases via NicknameParser
(vw4tools) parsed 0 zones, 0 aliases via AliShowZoneParser
(vw4tools) parsed 0 zones, 0 aliases via Alias4Parser
(vw4tools) parsed 0 zones, 0 aliases via BNAZoneParser
(vw4tools) parsed 0 zones, 0 aliases via DeviceAliasParser
(vw4tools) parsed 0 zones, 0 aliases via ShowZoneParser
(vw4tools) parsed 0 zones, 0 aliases via ShowZone2Parser
(vw4tools) parsed 0 zones, 0 aliases via VW4InvalidAddedParser
{
  "entities" : [ {
    "description" : "10000000c9123456,Oracle01 converted via NicknameParser from nicknamefile.csv",
    "edit_type" : "add",
    "name" : "Oracle01",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "10000000c9123456"
  }, {
    "description" : "10000000c9123457,oracle01 converted via NicknameParser from nicknamefile.csv",
    "edit_type" : "add",
    "name" : "oracle01_3457",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "10000000c9123457"
  } ],
  "version" : "1"
}
]], [stderr])

AT_CLEANUP()



AT_SETUP(write json sample sample01)
dnl      --------------------------

AT_CHECK([java -jar $abs_top_builddir/convjars/@PACKAGE@.jar -Tsample01 -o-], 0, [[{
  "entities" : [ {
    "description" : "sample01 test entity",
    "edit_type" : "add",
    "itl_patterns" : [ {
      "edit_type" : "add",
      "initiator" : "1000002590123456"
    } ],
    "name" : "sample01_itl",
    "type" : "application"
  } ],
  "version" : "1"
}
]],[stderr])

AT_CLEANUP()



AT_SETUP(write json sample sample02)
dnl      --------------------------

AT_CHECK([java -Dcompat.target=4.0.0 -jar $abs_top_builddir/convjars/@PACKAGE@.jar -Tsample02 -o-], 0, [[{
  "entities" : [ {
    "child_entities" : {
      "add" : [ "10000000c9123456" ]
    },
    "description" : "sample02 test FA",
    "edit_type" : "add",
    "name" : "sample_02",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "iomodule"
  } ],
  "version" : "1"
}
]],[stderr])

AT_CHECK([java -jar $abs_top_builddir/convjars/@PACKAGE@.jar -Tsample02 -o-], 0, [[{
  "entities" : [ {
    "description" : "sample02 test FA",
    "edit_type" : "add",
    "name" : "sample_02",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "fcport",
    "wwn" : "10000000c9123456"
  } ],
  "version" : "1"
}
]],[stderr])

AT_CLEANUP()



AT_SETUP(write json sample sample03)
dnl      --------------------------

AT_CHECK([java -Dcompat.target=4.0.0 -jar $abs_top_builddir/convjars/@PACKAGE@.jar -Tsample03 -o-], 0, [[{
  "entities" : [ {
    "child_entities" : {
      "add" : [ "500a098598123456" ]
    },
    "description" : "sample03 test NetApp",
    "edit_type" : "add",
    "name" : "NetApp 01 A",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "iomodule"
  }, {
    "child_entities" : {
      "add" : [ "500a098698123456" ]
    },
    "description" : "sample03 test NetApp",
    "edit_type" : "add",
    "name" : "NetApp 01 B",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "iomodule"
  }, {
    "child_entities" : {
      "add" : [ "10000000c9123456" ]
    },
    "description" : "sample03 test HBA",
    "edit_type" : "add",
    "name" : "hba 02 A",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "hba"
  }, {
    "child_entities" : {
      "add" : [ "10000000c9123457" ]
    },
    "description" : "sample03 test HBA",
    "edit_type" : "add",
    "name" : "hba 02 B",
    "tags" : [ "@PACKAGE@-@VERSION@-@BUILDID@" ],
    "type" : "hba"
  } ],
  "version" : "1"
}
]],[stderr])

AT_CLEANUP()



AT_SETUP(local testcase)
dnl      --------------

AT_CHECK([if test x@USERTESTCASE@ = xmissing ; then exit 77; fi])

AT_CLEANUP()



AT_SETUP(Doxygen confirmation of marked-up content)
dnl      -----------------------------------------

AT_CHECK([if test x@DOXYGEN@ = xmissing ; then exit 77; fi])
AT_CHECK([if test -z "@DO_DOXYGEN_TRUE@"; then exit 77; fi])
AT_CHECK([make -C $abs_top_builddir Doxyfile], 0, [stdout],[])
AT_CHECK([(cd $abs_top_builddir && @DOXYGEN@)], 0, [stdout],[stderr])
dnl used to put the errors at the bottom of the output
AT_CHECK([grep -v 'INFO: Rendered page #' stderr | grep -v 'org.apache.fop.events.LoggingEventListener processEvent'], 1, [],[])

AT_CLEANUP()


